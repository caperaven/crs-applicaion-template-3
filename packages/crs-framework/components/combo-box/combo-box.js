const o="loading";class n extends crs.classes.BindableElement{#s;#e;#t;get html(){return import.meta.url.replace(".js",".html")}get shadowDom(){return!0}get items(){return this.#e}set items(t){this.#e=t,this.#r().catch(e=>console.error(e))}get value(){return this.getProperty("value")}set value(t){this.setProperty("value",t),this.#t!=!0&&this.#o(t)}get text(){return this.getProperty("searchText")}async connectedCallback(){this.#t=o,this.#s=this.querySelector("template"),await this.#n(),await super.connectedCallback()}load(){return new Promise(t=>{requestAnimationFrame(async()=>{this.#s||=this.shadowRoot.querySelector("#tplDefaultItem"),await this.#r(),this.#t=!1;const e=this.getProperty("value");this.#o(e),await crs.call("component","notify_ready",{element:this}),t()})})}#o(t){if(this.#t===o)return;if((t??"").trim().length==0)return this.setProperty("searchText","");const s=Array.from(this.shadowRoot.querySelectorAll("option")).find(r=>r.value==t);s!=null&&this.setProperty("searchText",s.textContent)}async#n(){const t=this.querySelectorAll("option");t.length>0&&(this.#e=Array.from(t).map(e=>({value:e.value,text:e.innerText}))),this.innerHTML=""}async#r(){if(this.#e==null)return;const t=document.createDocumentFragment();for(const e of this.#e){const s=document.createElement("option");s.value=e.value,s.innerText=e.text,t.appendChild(s)}this.shadowRoot.querySelector("ul").appendChild(t)}async select(t){this.#t=!0;try{const e=t.composedPath()[0];if(e.nodeName!=="OPTION")return;this.value=e.value,await this.setProperty("searchText",e.textContent),this.shadowRoot.dispatchEvent(new CustomEvent("change",{detail:{value:this.value},composed:!0}))}finally{this.#t=!1}}async search(t){const s=t.composedPath()[0].value}}customElements.define("combo-box",n);
