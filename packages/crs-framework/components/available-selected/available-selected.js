import"./../../components/tab-list/tab-list.js";import{ItemsFactory as l}from"./items-factory.js";class r extends HTMLElement{#i=this.#n.bind(this);#s;#t;#e;#a;get clickedHandler(){return this.#i}get html(){return import.meta.url.replace(".js",".html")}constructor(){super(),this.attachShadow({mode:"open"})}async connectedCallback(){this.shadowRoot.innerHTML=await fetch(this.html).then(e=>e.text()),this.innerHTML=await fetch(import.meta.url.replace(".js",".lightdom.html")).then(e=>e.text()),await this.load()}async load(){requestAnimationFrame(async()=>{this.shadowRoot.addEventListener("click",this.#i),this.#s=this.shadowRoot.querySelector("tab-list"),this.#a="selected",await crs.binding.translations.parseElement(this),await crs.call("component","notify_ready",{element:this})})}async disconnectedCallback(){await this.shadowRoot.removeEventListener("click",this.#i),this.#i=null,this.#e=null,this.#a=null,this.#s=null,this.dataset.drag==="true"&&await this.#l(),this.#t=this.#t?.dispose()}async#n(e){const t=e.composedPath()[0];t.dataset.action!=null&&this[t.dataset.action]!=null&&await this[t.dataset.action](e)}async toggle(e){const t=e.composedPath()[1],a=t.getAttribute("class");a!==this.#a&&(this.#a=a);const s=a==="available"?"selected":"available",i=this.#e[a].find(n=>`${n[this.dataset.idField||"id"]}`==`${t.dataset.id}`);await crs.call("array","transfer",{source:this.#e[a],target:this.#e[s],value:i}),await this.update(this.#e,!1)}async update(e,t=!0){this.#e=e;const a=await l.createTemplate(this,this.#a,"selected",this.#e),s=await l.createTemplate(this,this.#a,"available",this.#e);this.#t!=null&&(this.dataset.drag==="true"&&await this.#l(),this.shadowRoot.removeChild(this.#t),this.#t=await this.#t?.dispose());const i=document.createElement("perspective-element");i.appendChild(a),i.appendChild(s),i.dataset.store=i._dataId,this.shadowRoot.appendChild(i),this.#t=i,this.#s.target=this.#t,t===!0&&(this.#a="selected",await this.#s.selectTab(this.#a)),this.dataset.drag==="true"&&await this.#r()}getSelectedItems(){return this.#e.selected}async#r(){this.#t.view==="selected"&&crs.binding.idleTaskManager.add(async()=>{const e=this.#t.querySelector("ul");await crs.call("dom_interactive","enable_dragdrop",{element:e,options:{drag:{query:'[data-action="drag"]',cpIndex:1},drop:{allowDrop:async(t,a)=>{if(a.currentAction=="drop")return t.tagName==="LI"?{target:t,position:"before"}:t.parentElement&&t.parentElement.tagName==="LI"?{target:t.parentElement,position:"before"}:t.tagName!=="UL"?null:{target:t,position:"append"};if(t.tagName==="LI"||t.tagName==="UL")return{target:t}},callback:async(t,a,s)=>{this.#e.selected.splice(a,0,...this.#e.selected.splice(t,1))}}}})})}async#l(){await crs.call("dom_interactive","disable_dragdrop",{element:this.#t.querySelector("ul")})}}customElements.define("available-selected",r);export{r as AvailableSelected};
